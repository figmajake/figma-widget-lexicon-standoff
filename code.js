(() => {
  // node_modules/lexicon-data/index.mjs
  var lexiconTopics = [
    [
      "Cartoons",
      "Children's Books",
      "Classic Books",
      "Classic Movies",
      "Cult Classic",
      "Disney Movies",
      "Documentaries",
      "High School Reads",
      "Horror Movies",
      "Improvisational Comedy",
      "Novels",
      "Painting",
      "Picture Books",
      "Podcasts",
      "Poems",
      "Popular Books",
      "Radio Shows",
      "Rated R",
      "Sculpture",
      "Silent Films",
      "Slapstick",
      "Soap Opera",
      "Superhero Movies",
      "Television Drama",
      "YouTube Videos"
    ],
    [
      "Actors",
      "Assassins",
      "Barbers",
      "Beat Poets",
      "Carpenters",
      "Composers",
      "Dentists",
      "Doctors",
      "Entertainers",
      "Famous Athletes",
      "Foot Doctors",
      "Gynecologists",
      "Lawyers",
      "Lumberjacks",
      "Magicians",
      "Massage Therapists",
      "Military Personnel",
      "Musicians",
      "News Anchors",
      "Street Performers",
      "Strippers",
      "Surgeons",
      "The Police",
      "Ventriloquists",
      "Writers"
    ],
    [
      "Abandoned Buildings",
      "Bank Vaults",
      "Belly of a Ship",
      "Broadway",
      "Bucket-list Destinations",
      "Cabins",
      "Community Centers",
      "Dark Corridors",
      "Dungeons",
      "Exploratory Submarines",
      "Graveyards",
      "Halfway Houses",
      "Lighthouses",
      "Mansions",
      "Medieval Times",
      "Monasteries",
      "Old Elevators",
      "Places to Hide",
      "Scary Places",
      "Secret Places",
      "Spooky Houses",
      "Tents",
      "Theme Parks",
      "Times Square",
      "Wine Cellars",
      "Woodsheds"
    ],
    [
      "Academic Probation",
      "Cafeteria",
      "Community College",
      "Daycare",
      "Detention",
      "Dormitories",
      "Drinking Fountains",
      "Elementary School",
      "Grad School",
      "Gymnasiums",
      "Hall Pass",
      "High School",
      "Homecoming",
      "Janitorial Closets",
      "Library",
      "Locker Rooms",
      "Playground",
      "Principal's Office",
      "Prom",
      "Recess",
      "Rigid Teaching",
      "School Bell",
      "Show-and-tell",
      "Study Hall",
      "Universities"
    ],
    [
      "Anarchism",
      "Atheism",
      "Buddhism",
      "Church",
      "Communism",
      "Conservatism",
      "Ghosts",
      "Hinduism",
      "Holy War",
      "Islam",
      "Jesus Christ",
      "Judeo-Christian Values",
      "Keeping the Peace",
      "Meditation",
      "Mormonism",
      "Mysticism",
      "Nazis",
      "Palm Reading",
      "Reincarnation",
      "Religious Extremism",
      "Scientology",
      "Sex Cults",
      "Socialism",
      "The Pope",
      "White Nationalism"
    ],
    [
      "Artificial Intelligence",
      "Bitcoin",
      "Computers",
      "eBay",
      "Email",
      "Facial Recognition",
      "Google Maps",
      "Instagram",
      "iPads",
      "iPod",
      "Pinterest",
      "Programming",
      "Self-driving Vehicles",
      "Selling User Data",
      "Sex Robots",
      "Smart Fridges",
      "Solar Power",
      "Startups",
      "Technology",
      "Tesla",
      "The Matrix",
      "Tinder",
      "Twitter",
      "Uber",
      "Virtual Reality"
    ],
    [
      "Alien Life",
      "Astronauts",
      "Asteroids",
      "Atmosphere",
      "Black Holes",
      "Gravitational Pull",
      "Hubble Telescope",
      "International Space Station",
      "Lunar Lander",
      "Mars",
      "Meteor Shower",
      "Milky Way Galaxy",
      "Mission Control",
      "Moon Rocks",
      "NASA",
      "Rocket Launch",
      "Satellites",
      "Space Suits",
      "Space Travel",
      "Space Walk",
      "Telescopes",
      "The 5th Dimension",
      "The Cosmos",
      "The Solar System",
      "UFOs",
      "Wormhole"
    ],
    [
      "Beeping",
      "Burping",
      "Clapping",
      "Coughing",
      "Ear Ringing",
      "Farting",
      "Groaning",
      "Hiccups",
      "Honking",
      "Howling",
      "Humming",
      "Knocking",
      "Moaning",
      "Nail Biting",
      "Nervous Tic",
      "Singing",
      "Smelling",
      "Snapping",
      "Sneezing",
      "Stomping",
      "Twitching",
      "Whining",
      "Whistling",
      "Yawning",
      "Yelling"
    ],
    [
      "Being a DJ",
      "Coachella",
      "Craft Breweries",
      "Cutting Your Own Hair",
      "Farmer's Markets",
      "Gentrification",
      "Hipster Coffee Shops",
      "Homemade Kale Chips",
      "Infinite Jest",
      "Ironic Dancing",
      "Ironic Pets",
      "Ironic Tattoos",
      "Mansplaining",
      "Michelin-starred Restaurant",
      "Mustaches",
      "Non-Prescription Glasses",
      "Not Drinking Craft Beer",
      "Pour-over Coffee",
      "Record Collections",
      "Silicon Valley",
      "Skinny Jeans",
      "Tech Bro",
      "Thrift Stores",
      "Vaping",
      "YOLO"
    ],
    [
      "Amazon",
      "Apple Inc.",
      "BP",
      "Cable Companies",
      "Car Dealerships",
      "Coca Cola",
      "Disney",
      "Facebook",
      "Ford Motor Company",
      "Google",
      "Health Insurance",
      "Hulu",
      "Kickstarter",
      "McDonalds",
      "Microsoft",
      "Netflix",
      "Nike",
      "Nintendo",
      "Samsung",
      "SpaceX",
      "Spotify",
      "The Pharmaceutical Industry",
      "Toyota",
      "Walgreens",
      "Walmart"
    ],
    [
      "All-you-can-eat Buffet",
      "Breakfast",
      "Canned Pineapple",
      "Carbohydrates",
      "Cereal",
      "Crab Legs",
      "Dietary Restrictions",
      "Dinner",
      "Dipping Sauce",
      "Fried Chicken",
      "Frozen Pizza",
      "Fruits",
      "Hamburgers",
      "Hot Dogs",
      "Leg of Lamb",
      "Liquor",
      "Lunch",
      "Meat",
      "Peanut Butter",
      "Protein",
      "Seafood",
      "SPAM",
      "Tacos",
      "Vegans",
      "Veggies",
      "Wine"
    ],
    [
      "A Jury",
      "Campaigning",
      "Congressperson",
      "Democracy",
      "Elections",
      "FBI",
      "Foreign Embassy",
      "Foreign Policy",
      "Governors",
      "House of Commons",
      "Judges",
      "Knighthood",
      "Mayors",
      "Monarchy",
      "NSA",
      "Parliament",
      "Politics",
      "Polls",
      "Prime Ministers",
      "Senators",
      "The American Presidency",
      "The United Nations",
      "The Washington Monument",
      "The White House",
      "Voting"
    ],
    [
      "Ballooning",
      "Beaches",
      "Birdwatching",
      "Bungee Jumping",
      "Camel Safari",
      "Camping",
      "Campfires",
      "Canoing",
      "Canyoning",
      "Fishing",
      "Hiking",
      "Horse Riding",
      "Hunting",
      "Jetskiing",
      "Lost at Sea",
      "Mountains",
      "Mushroom Hunting",
      "Palm Trees",
      "Rainforest",
      "Rock Climbing",
      "Safari Park",
      "Sailing",
      "Scuba Diving",
      "Skiing",
      "Skydiving",
      "Snorkeling",
      "Surfing",
      "The Great Outdoors",
      "Ziplining"
    ],
    [
      "Addiction",
      "Alzheimer's",
      "Asthma",
      "Cancer",
      "Diseases",
      "Domestic Disputes",
      "Drowning",
      "Dying of Old Age",
      "Earthquake",
      "Electrocution",
      "Epilepsy",
      "Famine",
      "Flood",
      "Harassment",
      "Heart Disease",
      "House Fires",
      "Hurricanes",
      "Infections",
      "Legal Execution",
      "Malaria",
      "Murder",
      "SARS-CoV-2",
      "Stabbing",
      "Stroke",
      "Self Immolation",
      "Syphilis",
      "Tornadoes",
      "Tsunami",
      "Venomous Snake Bite"
    ],
    [
      "Bathing",
      "Cleaning the Microwave",
      "Cleaning the Toilet",
      "Cleanliness",
      "Clogged Drain",
      "Dirty Sheets",
      "Discarding Pet Waste",
      "Dish Soap",
      "Doing the Dishes",
      "Dusting",
      "Grass-stained Pants",
      "Laundry",
      "Making the Bed",
      "Messy Desk",
      "Mopping",
      "OCD",
      "Organizing",
      "Pedicures",
      "Red Kool-Aid Mustache",
      "Shampoo",
      "Smelly Armpits",
      "Stained Shirt",
      "Sweeping the Floor",
      "Vacuuming",
      "Window Washing"
    ],
    [
      "Bathing Suits",
      "Blizzards",
      "Caves",
      "Clouds",
      "Downpour",
      "Droughts",
      "Glaciers",
      "Hail",
      "Heat Wave",
      "Lightning Storm",
      "Lightning Strike",
      "Ocean Waves",
      "Rainbows",
      "Road Salt",
      "Sandcastles",
      "Scarves",
      "Spring",
      "Summer",
      "Sunbeams",
      "Sunscreen",
      "Snow Fortress",
      "Snow Pants",
      "Snow Shoes",
      "Snowballs",
      "Umbrellas",
      "Wind in Your Hair",
      "Winter",
      "Winter Gloves"
    ],
    [
      "Airplane Travel",
      "Bike Commute",
      "Blimps",
      "Bus Rides",
      "Cable Cars",
      "Carpooling",
      "Convertibles",
      "Dog Sledding",
      "Golf Carts",
      "Hang Gliders",
      "Helicopters",
      "Horse Carriages",
      "Jet Packs",
      "Jogging",
      "Minivans",
      "Motorcycle",
      "Off-Roading",
      "Pogo Stick",
      "Recreational Vehicles",
      "Rickshaws",
      "Road Trip",
      "Roller Blades",
      "Skateboards",
      "SUVs",
      "Trains",
      "Unicycles",
      "Yachts"
    ],
    [
      "America's Funniest Home Videos",
      "AOL Instant Messenger",
      "Blockbuster Video",
      "Burning CDs",
      "Cassette Tapes",
      "Chuck-e-cheese",
      "Dial-up Internet",
      "Family Matters",
      "Fruit by the Foot",
      "Furby",
      "Gameboy",
      "Hot Wheels",
      "Ice-Cream Cups with Wooden Spoons",
      "Kenan and Kel",
      "Koosh Balls",
      "Land-line Phone",
      "Lunchables",
      "Magic Eye",
      "Mr. Potato Head",
      "Power Rangers",
      "Rugrats",
      "Scratch-and-sniff Stickers",
      "Silly Putty",
      "Slap Bracelets",
      "Slip n Slide",
      "Temporary Tattoos",
      "Tomagotchi",
      "VHS Tapes",
      "Windows 95"
    ],
    [
      "Anniversaries",
      "Baby Shower",
      "Bachelor Party",
      "Bachelorette Party",
      "Baptism",
      "Bar Mitzvahs",
      "Birthdays",
      "Business Meeting",
      "Christening",
      "Christmas",
      "Coming Out",
      "Conference Call",
      "Conventions",
      "Funerals",
      "Independence Day",
      "Kwanzaa",
      "Moving-in",
      "Moving-out",
      "New Years Eve",
      "Parades",
      "Swearing-in",
      "Thanksgiving",
      "The Golden Globes",
      "The Grammys",
      "The Oscars",
      "Trial",
      "Weddings"
    ],
    [
      "American",
      "Amsterdam",
      "Australia",
      "Big Ben",
      "Berlin Wall",
      "Brazil",
      "Canada",
      "Chicago",
      "Christ The Redeemer",
      "Egypt",
      "Eiffel Tower",
      "Florida",
      "Golden Gate Bridge",
      "Great Wall of China",
      "India",
      "Leaning Tower of Pisa",
      "London",
      "Los Angeles",
      "Madagascar",
      "New York",
      "Stonehenge",
      "Sydney Opera House",
      "Taj Mahal",
      "The Colosseum",
      "The Hollywood Sign",
      "The Louvre",
      "The Pyramids of Giza",
      "The Sphinx",
      "The Statue of Liberty",
      "Tokyo"
    ],
    [
      "Asking a Favor",
      "Birthday Wishes",
      "Bothering Dad",
      "Brutal Honesty",
      "Cigarette Break",
      "Cooking Meth",
      "Finding Cocaine",
      "Found it in the Trash",
      "Gambling",
      "Getting Drunk",
      "Getting High",
      "Happy Hour",
      "High on Bath Salts",
      "Intimate Secrets",
      "Onomatopoeia",
      "PCP",
      "Pornographic Paraphernalia",
      "Reality TV Personality",
      "Recipes for Disaster",
      "Shark Tank Ideas",
      "Smoking Crack",
      "Smoking Weed",
      "Sorority Initiation",
      "Talent Show Fail",
      "Talking to Yourself",
      "What's that Smell?"
    ],
    [
      "Annoyance",
      "Arrogance",
      "Authenticity",
      "Barbaric",
      "Boredom",
      "Calm Yourself",
      "Cheating",
      "Chill Out",
      "Deceit",
      "Depression",
      "Eccentric",
      "Enthralling",
      "Flirtatious",
      "Frustrating",
      "Grandiose",
      "Guilty",
      "Hesitance",
      "Honest Folks",
      "Joy",
      "Liars",
      "Mysterious",
      "Perverted",
      "Pleasure",
      "Pride"
    ],
    [
      "American Football",
      "Archery",
      "Badminton",
      "Baseball",
      "Boxing",
      "Cock Fighting",
      "Cricket",
      "Croquet",
      "Diving",
      "Dog Races",
      "Golf",
      "Gymnastics",
      "Hockey Pucks",
      "Jai Alai",
      "Karate",
      "Lacrosse",
      "Rugby",
      "Slam Dunk",
      "Soccer",
      "Softball",
      "Table Tennis",
      "Touchdowns",
      "Volleyball",
      "Water Polo",
      "Wrestling"
    ],
    [
      "Assembly Line",
      "Back Alley",
      "Back Road",
      "Bridge",
      "Building Scaffolding",
      "Canals",
      "Farmland",
      "Highways",
      "Manufacturing Plant",
      "Nuclear Facility",
      "Parking Garage",
      "Pastures",
      "Prisons",
      "Public Transportation",
      "Road Construction",
      "Rooftop Decks",
      "Shopping Malls",
      "Sidewalks",
      "Skyscraper",
      "The Big City",
      "The Cottage",
      "The Suburbs",
      "Underground Bar",
      "Urban Concerns",
      "Wrong Side of the Tracks"
    ],
    [
      "Banjos",
      "Cello",
      "Classical Music",
      "Country Music",
      "Drum Kits",
      "EDM",
      "Grunge",
      "Guitars",
      "Indie Pop",
      "Jazz",
      "Lullabies",
      "Motown",
      "Opera",
      "Pianos",
      "Pop Music",
      "Punk",
      "Rap",
      "Reggae",
      "Rock and Roll",
      "R&B",
      "Sing Along",
      "Soul Music",
      "The Blues",
      "Tribal Music",
      "Violin"
    ],
    [
      "Abraham Lincoln",
      "Albert Einstein",
      "Aretha Franklin",
      "Aubrey Plaza",
      "Beyonc\xE9",
      "Denzel Washington",
      "Ellen Degeneres",
      "Elon Musk",
      "Helen Mirren",
      "JFK",
      "Jim Carrey",
      "Kanye West",
      "Lady Gaga",
      "Marilyn Monroe",
      "Mark Zukerberg",
      "Martin Luther King Jr",
      "Meryl Streep",
      "Michael Jordan",
      "Nelson Mandela",
      "Oprah",
      "Princess Diana",
      "Queen Elizabeth II",
      "Rhianna",
      "Spike Lee",
      "Stephen Curry",
      "Steve Jobs",
      "Viola Davis",
      "Whoopi Goldberg"
    ],
    [
      "100 Years Ago",
      "Adoption",
      "Ageism",
      "Being an Only Child",
      "BFF",
      "Childbirth",
      "Childhood Acquaintance",
      "Childhood Fantasy",
      "Childhood Pastime",
      "Deja Vu",
      "Generational",
      "Golden Age",
      "Growing Up",
      "In my day...",
      "Long-lost Cousin",
      "Mid-life Crisis",
      "Millennial",
      "New School",
      "Nostalgia",
      "Old School",
      "Orphans",
      "Prehistoric",
      "The Youth",
      "Trend",
      "Turning 100"
    ],
    [
      "Animal Cruelty",
      "Caste System",
      "Civil Rights",
      "Classism",
      "Class Action",
      "Colonization",
      "Common Good",
      "Corporate Donations",
      "Coup D'\xE9tat",
      "Education",
      "Eminent Domain",
      "Feudal System",
      "Gun Control",
      "Hard-working Citizen",
      "LGBTQ+",
      "Living on Welfare",
      "Manifest Destiny",
      "Middle Class",
      "Minimum Wage",
      "Political Assassination",
      "Poverty",
      "Prison Industrial Complex",
      "Slavery",
      "Wealthy Grandmothers",
      "Women's Suffrage"
    ],
    [
      "Amphibians",
      "Animal Kingdom",
      "Ant Colonies",
      "Apex Predators",
      "Bats",
      "Birds",
      "Carnivores",
      "Cheetahs",
      "Creepy Crawlers",
      "Crustaceans",
      "Cuddly Creatures",
      "Decaying Carcass",
      "Deep Ocean",
      "Dinosaurs",
      "Evolution",
      "Flying Insects",
      "Invasive Species",
      "Jellyfish",
      "Jungles",
      "Larvae",
      "Laughing Hyena",
      "Mammals",
      "Manatees",
      "Peacocks",
      "Photosynthesis",
      "Plant Life",
      "Primates",
      "Reptiles",
      "Rodents"
    ],
    [
      "A Rash",
      "Abscess",
      "Acne",
      "Anxiety",
      "Athlete's Foot",
      "Body Odor",
      "Common Cold",
      "Cold Sores",
      "Day-off",
      "Ear Wax",
      "Halitosis",
      "Hobbies",
      "Hyperventilation",
      "Panic Attacks",
      "Pastimes",
      "Sick Days",
      "Sleeping",
      "Snot",
      "Stress",
      "Sweating",
      "The Flu",
      "Vacations",
      "Wedgies",
      "Weekends",
      "Zits"
    ],
    [
      "Accomplishments",
      "Advertising",
      "Agriculture",
      "Archeology",
      "Begging",
      "Challenging",
      "Courage",
      "Daredevils",
      "Door-to-door Sales",
      "Heritage",
      "History Books",
      "Honor",
      "Magazines",
      "Gallery Tour",
      "Mythology",
      "National Geographic",
      "Newsletter",
      "Nostalgia",
      "Prestige",
      "Propaganda",
      "Proselytizing",
      "Psychology",
      "Pyramid Scheme",
      "Telemarketing",
      "Temptation",
      "The Humanities",
      "The Media"
    ]
  ];

  // src/theme.ts
  var theme = {
    block: {
      sm: 20,
      md: 36,
      lg: 64
    },
    color: {
      accent: "#FFF",
      background: "#FF0",
      text: "#000"
    },
    spacing: {
      sm: 8,
      md: 16,
      lg: 32
    },
    text: {
      sm: 12,
      md: 20,
      lg: 32
    }
  };

  // src/components/Avatar.tsx
  var { widget } = figma;
  var { Image } = widget;
  var Avatar = ({ size = "md", key, onClick, round, src }) => /* @__PURE__ */ figma.widget.h(Image, {
    cornerRadius: round ? theme.block[size] : 0,
    height: theme.block[size],
    key: key || void 0,
    onClick,
    src: src || "",
    width: theme.block[size]
  });

  // src/components/Button.tsx
  var { widget: widget2 } = figma;
  var { AutoLayout, Text } = widget2;
  var Button = ({
    children,
    onClick,
    size = "md",
    square = false,
    width = "hug-contents"
  }) => {
    const height = theme.block[size];
    return /* @__PURE__ */ figma.widget.h(AutoLayout, {
      cornerRadius: theme.block.lg,
      height,
      horizontalAlignItems: "center",
      fill: theme.color.text,
      onClick,
      padding: theme.spacing[size],
      verticalAlignItems: "center",
      width: square ? height : width
    }, /* @__PURE__ */ figma.widget.h(Text, {
      fontSize: theme.text[size],
      fill: theme.color.accent,
      fontWeight: "extra-bold"
    }, children));
  };

  // src/utils.ts
  var topicDisplays = {
    agent: [
      ["a", "b"],
      ["b", "a"]
    ],
    imposter: [
      ["a", "b", "c"],
      ["a", "c", "b"],
      ["b", "a", "c"],
      ["b", "c", "a"],
      ["c", "a", "b"],
      ["c", "b", "a"]
    ]
  };
  var randomOrderTopics = (role, topics) => {
    const source = topicDisplays[role];
    return source[Math.floor(Math.random() * source.length)].map((a) => topics[a]);
  };
  var userKey = (user) => ((user == null ? void 0 : user.sessionId) || 0).toString();
  var sortedPlayersByScore = (scores, players) => {
    const memo = {};
    return players.values().sort((a, b) => {
      const aKey = userKey(a);
      const bKey = userKey(b);
      const scoreA = memo[aKey] || scores.get(userKey(a)) || 0;
      memo[aKey] = scoreA;
      const scoreB = memo[bKey] || scores.get(userKey(a)) || 0;
      memo[bKey] = scoreB;
      if (scoreA > scoreB) {
        return -1;
      }
      if (scoreB > scoreA) {
        return 1;
      }
      return 0;
    });
  };
  var sortedPlayersByResponseTime = (responses, players) => {
    const memo = {};
    return players.values().sort((a, b) => {
      var _a, _b;
      const aKey = userKey(a);
      const bKey = userKey(b);
      const responseA = memo[aKey] || ((_a = responses.get(userKey(a))) == null ? void 0 : _a.time) || 0;
      memo[aKey] = responseA;
      const responseB = memo[bKey] || ((_b = responses.get(userKey(a))) == null ? void 0 : _b.time) || 0;
      memo[bKey] = responseB;
      if (responseA > responseB) {
        return 1;
      }
      if (responseB > responseA) {
        return -1;
      }
      return 0;
    });
  };

  // src/components/StatePlaying.tsx
  var { widget: widget3 } = figma;
  var { AutoLayout: AutoLayout2, Text: Text2 } = widget3;
  var StatePlaying = ({
    onResponse,
    onVote,
    players,
    responses,
    topics
  }) => {
    const voting = responses.entries().filter(Boolean).length >= players.size;
    const renderVoting = () => /* @__PURE__ */ figma.widget.h(AutoLayout2, {
      direction: "vertical",
      fill: theme.color.background,
      horizontalAlignItems: "center",
      spacing: theme.spacing.md,
      verticalAlignItems: "center",
      width: "fill-parent"
    }, sortedPlayersByResponseTime(responses, players).map(({ photoUrl, sessionId }) => {
      var _a;
      return /* @__PURE__ */ figma.widget.h(AutoLayout2, {
        cornerRadius: theme.block.lg,
        key: sessionId,
        fill: theme.color.text,
        onClick: () => onVote(sessionId.toString()),
        padding: { right: theme.spacing.md },
        spacing: theme.spacing.sm,
        verticalAlignItems: "center",
        width: "hug-contents"
      }, /* @__PURE__ */ figma.widget.h(Avatar, {
        key: sessionId,
        src: photoUrl,
        round: true
      }), /* @__PURE__ */ figma.widget.h(Text2, {
        fill: theme.color.accent,
        fontSize: theme.text.sm,
        italic: true
      }, (_a = responses.get(sessionId.toString())) == null ? void 0 : _a.value));
    }));
    const renderSubmissions = () => /* @__PURE__ */ figma.widget.h(AutoLayout2, {
      direction: "vertical",
      spacing: theme.spacing.md,
      horizontalAlignItems: "center",
      width: "hug-contents"
    }, /* @__PURE__ */ figma.widget.h(Button, {
      onClick: onResponse,
      width: "fill-parent"
    }, "Show me Secrets"), /* @__PURE__ */ figma.widget.h(Text2, {
      fontSize: theme.text.sm,
      fill: theme.color.text,
      italic: true
    }, "waiting for..."), /* @__PURE__ */ figma.widget.h(AutoLayout2, {
      spacing: theme.spacing.sm,
      verticalAlignItems: "center"
    }, players.values().map(({ photoUrl, sessionId }) => responses.get(sessionId.toString()) ? null : /* @__PURE__ */ figma.widget.h(Avatar, {
      key: sessionId,
      round: true,
      src: photoUrl
    }))));
    return /* @__PURE__ */ figma.widget.h(AutoLayout2, {
      direction: "vertical",
      fill: theme.color.background,
      spacing: theme.spacing.md,
      verticalAlignItems: "center"
    }, voting ? /* @__PURE__ */ figma.widget.h(AutoLayout2, {
      spacing: theme.spacing.sm,
      horizontalAlignItems: "center",
      direction: "vertical"
    }, /* @__PURE__ */ figma.widget.h(Topic, {
      topic: topics.a
    }), /* @__PURE__ */ figma.widget.h(Topic, {
      topic: topics.b
    })) : null, voting ? renderVoting() : renderSubmissions());
  };

  // src/components/StateResults.tsx
  var { widget: widget4 } = figma;
  var { AutoLayout: AutoLayout3, Text: Text3 } = widget4;
  var StateResults = ({
    kills,
    onDone,
    players,
    roles,
    scores,
    topics
  }) => {
    return /* @__PURE__ */ figma.widget.h(AutoLayout3, {
      direction: "vertical",
      fill: theme.color.background,
      horizontalAlignItems: "center",
      spacing: theme.spacing.md,
      verticalAlignItems: "center",
      width: "hug-contents"
    }, /* @__PURE__ */ figma.widget.h(Button, {
      onClick: onDone,
      width: "hug-contents"
    }, "Lobby"), /* @__PURE__ */ figma.widget.h(AutoLayout3, {
      spacing: theme.spacing.sm,
      direction: "vertical",
      horizontalAlignItems: "center",
      width: "fill-parent"
    }, /* @__PURE__ */ figma.widget.h(Topic, {
      topic: topics.a
    }), /* @__PURE__ */ figma.widget.h(Topic, {
      topic: topics.b
    }), /* @__PURE__ */ figma.widget.h(Topic, {
      topic: topics.c,
      emphasize: true
    })), /* @__PURE__ */ figma.widget.h(AutoLayout3, {
      spacing: theme.spacing.sm,
      direction: "vertical",
      width: "fill-parent"
    }, sortedPlayersByScore(scores, players).map((player) => {
      const key = userKey(player);
      const killVotes = kills.get(key);
      const role = roles.get(key);
      const killed = killVotes && killVotes.length > 0;
      const imposter = role === "imposter";
      return /* @__PURE__ */ figma.widget.h(AutoLayout3, {
        key,
        direction: "vertical",
        horizontalAlignItems: "center",
        width: "fill-parent"
      }, /* @__PURE__ */ figma.widget.h(AutoLayout3, {
        spacing: theme.spacing.sm,
        verticalAlignItems: "center"
      }, /* @__PURE__ */ figma.widget.h(Avatar, {
        round: true,
        src: player.photoUrl
      }), /* @__PURE__ */ figma.widget.h(Text3, {
        fontSize: theme.text.lg,
        fill: theme.color.text,
        fontWeight: "extra-bold"
      }, scores.get(key)), /* @__PURE__ */ figma.widget.h(AutoLayout3, {
        direction: "vertical",
        verticalAlignItems: "center"
      }, /* @__PURE__ */ figma.widget.h(Text3, {
        fontSize: theme.text.sm,
        fill: theme.color.text,
        fontWeight: imposter ? "normal" : "extra-bold",
        italic: imposter
      }, role), /* @__PURE__ */ figma.widget.h(Text3, {
        fontSize: theme.text.sm,
        fill: theme.color.text,
        fontWeight: killed ? "extra-bold" : "normal"
      }, killed ? "DEAD" : "SURVIVED"))), killed ? /* @__PURE__ */ figma.widget.h(AutoLayout3, {
        horizontalAlignItems: "center",
        spacing: theme.spacing.sm,
        verticalAlignItems: "center"
      }, killVotes.map((sessionId) => {
        const player2 = players.get(sessionId);
        return player2 ? /* @__PURE__ */ figma.widget.h(Avatar, {
          key: sessionId,
          round: true,
          src: player2.photoUrl,
          size: "sm"
        }) : null;
      })) : null);
    })));
  };

  // src/components/StateStart.tsx
  var { widget: widget5 } = figma;
  var { AutoLayout: AutoLayout4, Text: Text4 } = widget5;
  var StateStart = ({ onBoot, onJoin, onStart, players }) => {
    const minPlayers = 1;
    const playersNeeded = minPlayers - players.size;
    const ready = players.size >= minPlayers;
    const imposterCount = activeImposterCount(players);
    return /* @__PURE__ */ figma.widget.h(AutoLayout4, {
      direction: "vertical",
      fill: theme.color.background,
      horizontalAlignItems: "center",
      spacing: theme.spacing.md,
      verticalAlignItems: "center"
    }, /* @__PURE__ */ figma.widget.h(Text4, {
      fill: theme.color.text,
      fontSize: theme.text.lg,
      fontWeight: "extra-bold"
    }, "Lexicon Standoff"), players.size ? /* @__PURE__ */ figma.widget.h(AutoLayout4, {
      spacing: theme.spacing.sm,
      horizontalAlignItems: "center",
      width: "fill-parent"
    }, players.values().map((player) => /* @__PURE__ */ figma.widget.h(Avatar, {
      key: player.sessionId,
      onClick: () => onBoot(player.sessionId),
      round: true,
      src: player.photoUrl
    }))) : null, /* @__PURE__ */ figma.widget.h(AutoLayout4, {
      direction: "vertical",
      horizontalAlignItems: "center",
      spacing: theme.spacing.sm,
      width: "fill-parent"
    }, /* @__PURE__ */ figma.widget.h(Button, {
      onClick: onJoin
    }, "Join"), ready ? /* @__PURE__ */ figma.widget.h(Button, {
      onClick: onStart
    }, "Start Game") : null, /* @__PURE__ */ figma.widget.h(Text4, {
      fontSize: theme.text.sm,
      fill: theme.color.text,
      italic: true
    }, ready ? `there will be ${imposterCount} imposter${imposterCount === 1 ? "" : "s"}` : `waiting for ${playersNeeded}...`)));
  };

  // src/components/Topic.tsx
  var { widget: widget6 } = figma;
  var { Text: Text5 } = widget6;
  var Topic = ({ emphasize = false, topic }) => /* @__PURE__ */ figma.widget.h(Text5, {
    fill: theme.color.text,
    fontSize: theme.text.lg,
    fontWeight: emphasize ? "normal" : "extra-bold",
    italic: emphasize
  }, "\u201C", topic, "\u201D");

  // src/ui.ts
  function ui(topics, constraint, roles, currentUser2) {
    const sessionId = userKey(currentUser2);
    const role = roles.get(sessionId) || "agent";
    const shownTopics = randomOrderTopics(role, topics);
    return `
${uiStyle(theme)}
<section>
  <main>
    <p><em>you are an <strong>${role.toUpperCase()}</strong>!</em></p>
    <h1>${shownTopics.map((a) => `\u201C${a}\u201D`).join("<br>")}</h1>
    <p class="mb"><em>${constraint == null ? void 0 : constraint.toLowerCase()}</em></p>
  </main>
  <footer>
    <input id="input" type="text" required><br>
    <button id="button">Submit</button>
  </footer>
</section>
<script>
  const input = document.getElementById("input");
  const button = document.getElementById("button");
  button.addEventListener("click", () => {
    if (!input.value.trim()) {
      return;
    }
    const pluginMessage = { value: input.value, sessionId: "${sessionId}", store: "responses" };
    parent.postMessage({ pluginMessage }, '*');
    input.remove();
    button.remove();
  });
  input.focus();
<\/script>
`;
  }
  function uiStyle({ block, color, text, spacing }) {
    const pxToRem = (px) => `${px / 16}rem`;
    return `
  <style>
  * {
    box-sizing: border-box;
    font-family: Helvetica, sans-serif;
    margin: 0;
  }
  body {
    background: ${color.background};
    color: ${color.text};
    text-align: center;
  }
  html, body, section {
    height: 100%;
  }
  section {
    box-shadow: inset 0 0 0 ${pxToRem(spacing.sm)} ${color.text};
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 1rem;
  }
  main {
    display: flex;
    flex: 1;
    flex-direction: column;
    justify-content: center;
  }
  h1 {
    font-size: ${pxToRem(text.lg)};
    margin-bottom: ${pxToRem(spacing.sm)};
    margin-top: ${pxToRem(spacing.sm)};
  }
  p.mb {
    margin-bottom: ${pxToRem(spacing.md)};
  }
  button {
    margin-top: ${pxToRem(spacing.sm)};
  }
  input,
  button {
    appearance: none;
    background: ${color.text};
    border: none;
    border-radius: ${pxToRem(block.lg)};
    color: ${color.accent};
    display: inline-block;  
    font-weight: 900;
    outline: none;
    padding: ${pxToRem(spacing.sm)} ${pxToRem(spacing.md)};
    text-align: center;
  }

  input:focus-visible,
  button:focus-visible {
    box-shadow: 0 0 0 ${pxToRem(spacing.sm / 2)} ${color.accent};
  }
  </style>
`;
  }

  // src/code.tsx
  var { widget: widget7, activeUsers, currentUser } = figma;
  var { AutoLayout: AutoLayout5, useEffect, useSyncedMap, useSyncedState } = widget7;
  var activeImposterCount = (players) => Math.max(1, Math.round(1 / 3 * players.size));
  function Lexicon() {
    const killsMap = useSyncedMap("kills");
    const playersMap = useSyncedMap("players");
    const responsesMap = useSyncedMap("responses");
    const rolesMap = useSyncedMap("roles");
    const votesMap = useSyncedMap("votes");
    const scoresMap = useSyncedMap("scores");
    const [constraint, setConstraint] = useSyncedState("constraint", null);
    const [state, setState] = useSyncedState("state", "start");
    const [topics, setTopics] = useSyncedState("topics", null);
    useEffect(() => {
      figma.ui.onmessage = ({ value, sessionId, store }) => {
        switch (store) {
          case "responses":
            responsesMap.set(sessionId, { value, time: Date.now() });
            break;
        }
      };
    });
    const handleBoot = (sessionId) => {
      playersMap.delete(sessionId.toString());
    };
    const handleJoin = () => {
      const sessionId = userKey(currentUser);
      const user = activeUsers.find((user2) => userKey(user2) === sessionId);
      if (user) {
        playersMap.set(sessionId, user);
      }
    };
    const handleStart = () => {
      killsMap.keys().forEach((key) => killsMap.delete(key));
      responsesMap.keys().forEach((key) => responsesMap.delete(key));
      rolesMap.keys().forEach((key) => rolesMap.delete(key));
      votesMap.keys().forEach((key) => votesMap.delete(key));
      const imposterCount = activeImposterCount(playersMap);
      const ids = playersMap.values().map((user) => {
        rolesMap.set(userKey(user), "agent");
        return userKey(user);
      });
      const imposterIds = [];
      while (imposterIds.length < imposterCount) {
        const id = ids.splice(Math.floor(Math.random() * ids.length))[0];
        imposterIds.push(id);
        rolesMap.set(id, "imposter");
      }
      const constraints = [
        "Anything Goes",
        "A Question",
        "A Destination",
        "A Person",
        "3-Word Phrase"
      ];
      const clonedTopics = lexiconTopics.map((a) => [...a]);
      const chosen = [];
      while (chosen.length < 3) {
        const group = clonedTopics[Math.floor(Math.random() * clonedTopics.length)];
        const index = Math.floor(Math.random() * group.length);
        chosen.push(group.splice(index, 1)[0]);
      }
      setConstraint(constraints[Math.floor(Math.random() * constraints.length)]);
      setTopics({ a: chosen[0], b: chosen[1], c: chosen[2] });
      setState("playing");
    };
    const handleVote = (votedId) => {
      votesMap.set(userKey(currentUser), votedId);
      if (votesMap.entries().length >= playersMap.size) {
        handleVotesEnd();
      }
    };
    const handleVotesEnd = () => {
      let max = 0;
      const playerToVoted = {};
      const voteResult = votesMap.entries().reduce((votes, [voterId, votedId]) => {
        votes[votedId] = votes[votedId] || 0;
        votes[votedId]++;
        playerToVoted[votedId] = playerToVoted[votedId] || [];
        playerToVoted[votedId].push(voterId);
        max = Math.max(max, votes[votedId]);
        return votes;
      }, {});
      for (let id in voteResult) {
        if (voteResult[id] === max) {
          killsMap.set(id, playerToVoted[id]);
        }
      }
      playersMap.values().forEach((user) => {
        const key = userKey(user);
        const existing = scoresMap.get(key) || 0;
        const score = rolesMap.get(key) === "imposter" ? 2 : 1;
        if (killsMap.get(key)) {
          scoresMap.set(key, existing);
        } else {
          scoresMap.set(key, existing + score);
        }
      });
      setState("results");
    };
    const handleDone = () => setState("start");
    return /* @__PURE__ */ figma.widget.h(AutoLayout5, {
      cornerRadius: theme.block.md,
      direction: "vertical",
      fill: theme.color.background,
      stroke: theme.color.text,
      strokeWidth: theme.spacing.sm,
      padding: theme.spacing.lg,
      spacing: theme.spacing.md,
      width: "hug-contents"
    }, state === "start" ? /* @__PURE__ */ figma.widget.h(StateStart, {
      onBoot: handleBoot,
      onJoin: handleJoin,
      onStart: handleStart,
      players: playersMap
    }) : null, state === "playing" && topics ? /* @__PURE__ */ figma.widget.h(StatePlaying, {
      onResponse: () => new Promise(() => figma.showUI(ui(topics, constraint, rolesMap, currentUser), {
        height: 300,
        width: 400
      })),
      onVote: handleVote,
      players: playersMap,
      responses: responsesMap,
      topics,
      votes: votesMap
    }) : null, state === "results" && topics ? /* @__PURE__ */ figma.widget.h(StateResults, {
      kills: killsMap,
      onDone: handleDone,
      players: playersMap,
      roles: rolesMap,
      scores: scoresMap,
      topics
    }) : null);
  }
  widget7.register(Lexicon);
})();
